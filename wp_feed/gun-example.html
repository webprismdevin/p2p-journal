<html>
  <body>
    <h1 id="title">Journal</h1>

    <form id="sign">
      <input id="alias" placeholder="username">
      <input id="pass" type="password" placeholder="passphrase">
      <input id="in" type="submit" value="sign in">
      <input id="up" type="button" value="sign up">
    </form>

    <form id="said">
        <textarea id="say" cols=60 rows=20></textarea>
        <br>
        <input id="speak" type="submit" value="speak">
    </form>

    <ul></ul>

    <script src="https://cdn.jsdelivr.net/npm/gun/examples/jquery.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
    <!-- script src="https://cdn.jsdelivr.net/npm/gun/lib/webrtc.js"></script -->
    <script>
    var gun = Gun(['http://localhost:8765/gun']);
    var user = gun.user().recall({sessionStorage: true});

    $('#up').on('click', function(e){
      user.create($('#alias').val(), $('#pass').val());
    });

    $('#sign').on('submit', function(e){
      e.preventDefault();
      user.auth($('#alias').val(), $('#pass').val());
    });

    $('#said').on('submit', function(e){
      e.preventDefault();
      if(!user.is){ return }
      console.log('submitted');
      gun.get('thoughts').set($('say').val());
      $('#say').val("");
      // user.get('said').set($('#say').val());
      // $('#say').val("");
    });

    $('body').on('dblclick', 'li', function(e){
        gun.get('thoughts').get(this.id).put(null);
    });

    function UI(say, id){
      var li = $('#' + id).get(0) || $('<li>').attr('id', id).appendTo('ul');
      $(li).text(say);
    };

    gun.on('auth', function(){
      $('#sign').hide();
      user.get('said').map().once(UI);
    });

    gun.get('thoughts').map().on(UI);

    </script>
  </body>
</html>